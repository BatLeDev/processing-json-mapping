{
  "type": "object",
  "x-display": "tabs",
  "required": [
    "datasetMode"
  ],
  "allOf": [
    {
      "title": "Jeu de données",
      "oneOf": [
        {
          "title": "Créer un jeu de données",
          "required": [
            "dataset"
          ],
          "properties": {
            "datasetMode": {
              "type": "string",
              "const": "create",
              "title": "Action"
            },
            "dataset": {
              "type": "object",
              "required": [
                "title"
              ],
              "properties": {
                "title": {
                  "type": "string",
                  "title": "Titre"
                }
              }
            }
          }
        },
        {
          "title": "Mettre à jour un jeu de données",
          "required": [
            "dataset"
          ],
          "properties": {
            "datasetMode": {
              "type": "string",
              "const": "update"
            },
            "dataset": {
              "type": "object",
              "title": "Jeu de donnée existant",
              "x-fromUrl": "{context.dataFairUrl}/api/v1/datasets?q={q}&select=id,title&{context.ownerFilter}",
              "x-itemsProp": "results",
              "x-itemTitle": "title",
              "x-itemKey": "id",
              "properties": {
                "id": {
                  "type": "string",
                  "title": "Identifiant"
                },
                "title": {
                  "type": "string",
                  "title": "Titre"
                }
              }
            },
            "forceUpdate": {
              "title": "Forcer la mise à jour",
              "description": "La mise à jour forcée permet de remettre à jour le schéma en cas de modification sur le jeu de donnée",
              "type": "boolean",
              "default": false
            }
          }
        }
      ]
    },
    {
      "title": "Paramètres",
      "type": "object",
      "required": [
        "apiURL"
      ],
      "properties": {
        "apiURL": {
          "title": "URL de l'API",
          "type": "string"
        },
        "authorizationHeader": {
          "title": "Header Authorization",
          "type": "string"
        },
        "resultPath": {
          "title": "Clé dans l'objet JSON pointant sur le tableau de résultats",
          "description": "Chemin vers le tableau de résultats dans l'objet JSON (ex: data.results)",
          "type": "string"
        },
        "nextPagePath": {
          "title": "Clé dans l'objet JSON pour la page suivante",
          "description": "Clé dans l'objet JSON pour la page suivante (ex: data.next)",
          "type": "string"
        },
        "columns": {
          "type": "array",
          "title": "Colonnes à créer",
          "description": "L'ensemble des colonnes qui seront créé dans le jeu de donnée",
          "x-itemTitle": "titleProp",
          "items": {
            "type": "object",
            "required": [
              "columnPath"
            ],
            "properties": {
              "columnPath": {
                "type": "string",
                "title": "Chemin de la colonne",
                "description": "Chemin d'accès à la colonne dans le json (à partir du tableau de résultat)"
              },
              "columnName": {
                "type": "string",
                "title": "Nom de la colonne"
              },
              "multivalued": {
                "type": "boolean",
                "title": "Colonne multivalué",
                "description": "Un objet, un tableau,...",
                "default": false
              },
              "isPrimaryKey": {
                "type": "boolean",
                "title": "Clé primaire",
                "description": "La colonne sera une clé primaire",
                "default": false
              },
              "columnType": {
                "title": "Type de la colonne",
                "description": "Le type de la colonne",
                "type": "string",
                "enum": [
                  "Texte",
                  "Nombre",
                  "Date",
                  "Booléen",
                  "Objet"
                ],
                "enumLabels": [
                  "string",
                  "string",
                  "string",
                  "boolean",
                  "string"
                ],
                "default": "Texte"
              }
            }
          }
        }
      }
    }
  ]
}